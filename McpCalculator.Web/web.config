<?xml version="1.0" encoding="utf-8"?>
<!--
  IIS Configuration for McpCalculator.Web

  This web.config enables the ASP.NET Core Module to host the application
  within IIS. Key settings for MCP HTTP/SSE transport:

  1. WebSocket support (required for SSE/streaming)
  2. In-process hosting for better performance
  3. Proper environment variable configuration

  Prerequisites:
  - .NET 10 Hosting Bundle must be installed on the IIS server
  - WebSocket Protocol feature must be enabled in Windows Features
  - Application Pool must be set to "No Managed Code"

  For more details, see docs/IIS_DEPLOYMENT.md
-->
<configuration>
  <location path="." inheritInChildApplications="false">
    <system.webServer>
      <!-- ASP.NET Core Module handler configuration -->
      <handlers>
        <add name="aspNetCore"
             path="*"
             verb="*"
             modules="AspNetCoreModuleV2"
             resourceType="Unspecified"/>
      </handlers>

      <!-- ASP.NET Core hosting configuration -->
      <aspNetCore processPath="dotnet"
                  arguments=".\McpCalculator.Web.dll"
                  stdoutLogEnabled="false"
                  stdoutLogFile=".\logs\stdout"
                  hostingModel="InProcess">
        <environmentVariables>
          <!--
            Set to "Production" for production deployments.
            Set to "Development" to enable detailed errors and appsettings.Development.json
          -->
          <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Production"/>
        </environmentVariables>
      </aspNetCore>

      <!--
        Enable WebSocket protocol - REQUIRED for MCP SSE transport.
        Without this, Server-Sent Events connections will fail.
      -->
      <webSocket enabled="true"/>

      <!--
        Security headers - recommended for production.
        These headers help protect against common web vulnerabilities.
      -->
      <httpProtocol>
        <customHeaders>
          <add name="X-Content-Type-Options" value="nosniff"/>
          <add name="X-Frame-Options" value="DENY"/>
          <add name="X-XSS-Protection" value="1; mode=block"/>
          <remove name="X-Powered-By"/>
        </customHeaders>
      </httpProtocol>
    </system.webServer>
  </location>
</configuration>
